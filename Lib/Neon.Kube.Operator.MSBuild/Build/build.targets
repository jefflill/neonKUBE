<Project ToolsVersion="Current" >
    <Import Project="$(MSBuildThisFileDirectory)build.props"/>

    <Target Name="_GenerateRbac" DependsOnTargets="PropsConfig" >
        <Message Text="Generating RBAC Manifest" Importance="high" />
        
        <ItemGroup>
            <RbacArgs Include="generate"/>
            <RbacArgs Include="rbac"/>
            <RbacArgs Include="--assembly-path=&quot;$(TargetPath)&quot;"/>
            <RbacArgs Include="--output-path=&quot;$(OperatorRbacPath)&quot;"/>
            <RbacArgs Include="--name=&quot;$(OperatorName)&quot;"/>
            <RbacArgs Condition="'$(OperatorDeployedNamespace)' != ''" Include="--deployed-namespace=&quot;$(OperatorDeployedNamespace)&quot;"/>
            <RbacArgs Condition="'$(OperatorWatchNamespace)' != ''" Include="--watch-namespace=&quot;$(OperatorWatchNamespace)&quot;"/>
        </ItemGroup>

        <Exec Command="&quot;$(TargetDir)$(NETCoreSdkRuntimeIdentifier)\operator-cli.exe&quot; @(RbacArgs,' ')"  />
    </Target>
    
    <Target 
        Name="GenerateRbac" 
        DependsOnTargets="PropsConfig" 
        AfterTargets="PostBuildEvent"
        Condition="'$(OperatorDeployedNamespace)' != ''">
        <CallTarget  Targets="_GenerateRbac" />
    </Target>

</Project>




